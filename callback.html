<!DOCTYPE html>
<html>
<head>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const hash = window.location.hash
        .substring(1)
        .split('&')
        .reduce((initial, item) => {
          let parts = item.split('=');
          initial[parts[0]] = decodeURIComponent(parts[1]);
          return initial;
        }, {});

      chrome.storage.local.set({access_token: hash.access_token}, () => {
        if(chrome.runtime.lastError) {
            console.error(chrome.runtime.lastError.message);
        } else {
            console.log('Token stored');
            // Close this tab and open the main UI of your extension or whatever you want to do next
            window.close();
        }
      });
    });
  </script>
</head>
<body></body>
</html>
